/*
 * eDSP, A cross-platform Digital Signal Processing library written in modern C++.
 * Copyright (C) 2018 Mohammed Boujemaoui Boulaghmoudi
 *
 * This program is free software: you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option)
 * any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of  MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
 * more details.
 *
 * You should have received a copy of the GNU General Public License along with
 * this program.  If not, see <http://www.gnu.org/licenses/>
 *
 * File: testing_coscillators.cpp
 * Author: Mohammed Boujemaoui
 * Date: 05/10/2018
 */

#include <edsp/oscillator.hpp>
#include <gtest/gtest.h>
#include <algorithm>

template class edsp::oscillators::square_oscillator<float>;
template class edsp::oscillators::sin_oscillator<float>;
template class edsp::oscillators::triangular_oscillator<float>;
template class edsp::oscillators::sawtooth_oscillator<float>;

TEST(TestingSawtooth, 500HzSampling42000HzWidth30) {
    const auto frequency     = 500.0;
    const auto sampling_rate = 42000.0;
    const auto width         = 0.5;
    const auto amplitude     = 1.0;
    const auto size          = 2 * (1. / frequency) * sampling_rate;

    std::vector<double> data(size);
    edsp::oscillators::sawtooth_oscillator<double> sawtooth(amplitude, sampling_rate, frequency, width);
    std::generate(std::begin(data), std::end(data), sawtooth);

    static const std::vector<double> reference = {-1,
                                                      -0.9206349206349207,
                                                      -0.8412698412698413,
                                                      -0.7619047619047619,
                                                      -0.6825396825396826,
                                                      -0.6031746031746033,
                                                      -0.5238095238095238,
                                                      -0.4444444444444444,
                                                      -0.3650793650793651,
                                                      -0.2857142857142858,
                                                      -0.2063492063492065,
                                                      -0.1269841269841271,
                                                      -0.04761904761904767,
                                                      0.03174603174603163,
                                                      0.1111111111111112,
                                                      0.1904761904761905,
                                                      0.2698412698412698,
                                                      0.3492063492063491,
                                                      0.4285714285714284,
                                                      0.5079365079365079,
                                                      0.587301587301587,
                                                      0.6666666666666665,
                                                      0.7460317460317458,
                                                      0.8253968253968254,
                                                      0.9047619047619047,
                                                      0.9841269841269842,
                                                      0.9727891156462586,
                                                      0.9387755102040819,
                                                      0.9047619047619048,
                                                      0.870748299319728,
                                                      0.8367346938775511,
                                                      0.8027210884353742,
                                                      0.7687074829931972,
                                                      0.7346938775510206,
                                                      0.7006802721088436,
                                                      0.6666666666666667,
                                                      0.6326530612244899,
                                                      0.5986394557823129,
                                                      0.5646258503401361,
                                                      0.5306122448979593,
                                                      0.4965986394557825,
                                                      0.4625850340136056,
                                                      0.4285714285714287,
                                                      0.3945578231292518,
                                                      0.360544217687075,
                                                      0.3265306122448979,
                                                      0.2925170068027212,
                                                      0.2585034013605444,
                                                      0.2244897959183674,
                                                      0.1904761904761906,
                                                      0.1564625850340136,
                                                      0.1224489795918368,
                                                      0.08843537414966007,
                                                      0.05442176870748294,
                                                      0.02040816326530648,
                                                      -0.01360544217687054,
                                                      -0.04761904761904767,
                                                      -0.08163265306122414,
                                                      -0.115646258503401,
                                                      -0.1496598639455782,
                                                      -0.1836734693877549,
                                                      -0.2176870748299318,
                                                      -0.2517006802721087,
                                                      -0.2857142857142856,
                                                      -0.3197278911564625,
                                                      -0.3537414965986394,
                                                      -0.3877551020408161,
                                                      -0.4217687074829932,
                                                      -0.4557823129251701,
                                                      -0.4897959183673468,
                                                      -0.5238095238095235,
                                                      -0.5578231292517009,
                                                      -0.5918367346938771,
                                                      -0.6258503401360545,
                                                      -0.6598639455782311,
                                                      -0.693877551020408,
                                                      -0.7278911564625847,
                                                      -0.7619047619047621,
                                                      -0.7959183673469383,
                                                      -0.8299319727891157,
                                                      -0.8639455782312924,
                                                      -0.8979591836734691,
                                                      -0.931972789115646,
                                                      -0.9659863945578226,
                                                      -1,
                                                      -0.9206349206349209,
                                                      -0.8412698412698418,
                                                      -0.7619047619047628,
                                                      -0.6825396825396837,
                                                      -0.6031746031746046,
                                                      -0.5238095238095239,
                                                      -0.4444444444444449,
                                                      -0.3650793650793658,
                                                      -0.2857142857142867,
                                                      -0.2063492063492076,
                                                      -0.1269841269841285,
                                                      -0.047619047619048,
                                                      0.03174603174603119,
                                                      0.1111111111111103,
                                                      0.1904761904761894,
                                                      0.2698412698412698,
                                                      0.3492063492063475,
                                                      0.4285714285714279,
                                                      0.507936507936507,
                                                      0.5873015873015861,
                                                      0.6666666666666652,
                                                      0.7460317460317458,
                                                      0.8253968253968249,
                                                      0.9047619047619024,
                                                      0.9841269841269831,
                                                      0.972789115646259,
                                                      0.9387755102040823,
                                                      0.9047619047619049,
                                                      0.8707482993197282,
                                                      0.8367346938775521,
                                                      0.8027210884353747,
                                                      0.7687074829931979,
                                                      0.7346938775510212,
                                                      0.7006802721088439,
                                                      0.666666666666667,
                                                      0.6326530612244903,
                                                      0.5986394557823129,
                                                      0.5646258503401368,
                                                      0.53061224489796,
                                                      0.4965986394557826,
                                                      0.4625850340136058,
                                                      0.4285714285714292,
                                                      0.3945578231292518,
                                                      0.360544217687075,
                                                      0.3265306122448989,
                                                      0.2925170068027215,
                                                      0.2585034013605447,
                                                      0.224489795918368,
                                                      0.1904761904761906,
                                                      0.1564625850340139,
                                                      0.1224489795918378,
                                                      0.0884353741496603,
                                                      0.05442176870748361,
                                                      0.02040816326530681,
                                                      -0.01360544217687054,
                                                      -0.04761904761904723,
                                                      -0.08163265306122414,
                                                      -0.1156462585034015,
                                                      -0.1496598639455775,
                                                      -0.1836734693877542,
                                                      -0.2176870748299318,
                                                      -0.2517006802721085,
                                                      -0.2857142857142851,
                                                      -0.3197278911564625,
                                                      -0.3537414965986394,
                                                      -0.3877551020408154,
                                                      -0.4217687074829928,
                                                      -0.4557823129251695,
                                                      -0.4897959183673462,
                                                      -0.5238095238095235,
                                                      -0.5578231292517004,
                                                      -0.5918367346938764,
                                                      -0.6258503401360538,
                                                      -0.6598639455782305,
                                                      -0.6938775510204074,
                                                      -0.7278911564625841,
                                                      -0.7619047619047614,
                                                      -0.7959183673469383,
                                                      -0.8299319727891143,
                                                      -0.8639455782312917,
                                                      -0.8979591836734684,
                                                      -0.9319727891156453,
                                                      -0.9659863945578226};

    EXPECT_EQ(size, reference.size());
    for (auto i = 0ul; i < size; ++i) {
        //EXPECT_NEAR(data[i], reference[i], 1e-3);
    }
}
